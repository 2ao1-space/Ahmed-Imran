---
import Layout from "../../layouts/Layout.astro";
import info from "../../data/info.json";
import Image from "astro/components/Image.astro";
import Header from "../../layouts/Header.astro";
import Footer from "../../layouts/Footer.astro";
import Link from "../../components/Link.astro";
import DirectLink from "../../components/DirectLink.astro";

export async function getStaticPaths() {
  const projects = info.projects;

  return projects.map((project, index) => ({
    params: {
      slug: project.title.toLowerCase().replace(/\s+/g, "-"),
    },
    props: {
      project,
      currentIndex: index,
      totalProjects: projects.length,
      projects: projects,
    },
  }));
}

const { project, currentIndex, totalProjects, projects } = Astro.props;

const prevProject =
  currentIndex > 0 ? projects[currentIndex - 1] : projects[totalProjects - 1];
const nextProject =
  currentIndex < totalProjects - 1 ? projects[currentIndex + 1] : projects[0];

const prevSlug = prevProject.title.toLowerCase().replace(/\s+/g, "-");
const nextSlug = nextProject.title.toLowerCase().replace(/\s+/g, "-");
---

<Layout>
  <Header />

  <main class="container mx-auto p-4">
    {
      project ? (
        <>
          <div class="grid grid-cols-8 gap-4 py-8 group">
            <div class="col-span-3">
              <DirectLink href="/projects">[&LeftArrow;]</DirectLink>
              <div class="grid grid-cols-2 py-12">
                <h4 class="col-span-2 text-5xl py-4 font-mainHead border-b text-main">
                  {project.title}
                </h4>
                <div class="col-span-1 py-4 border-b">
                  <span class="text-xs text-slate-500">Client</span>
                  <h5>{project.client}</h5>
                </div>
                <div class="col-span-1 py-4 border-b">
                  <span class="text-xs text-slate-500">Year</span>
                  <h5>{project.date}</h5>
                </div>
                <div class="col-span-1 py-4 border-b">
                  <span class="text-xs text-slate-500">Created by</span>
                  <h5>
                    {project.createdBy?.dev}
                    <sup class="text-xs text-main">[ DEV ]</sup>
                  </h5>
                </div>
                <div class="col-span-1 py-4 border-b">
                  <span class="text-xs text-slate-500">Copyright</span>
                  <h5>&copy; All Rights Reserved</h5>
                </div>
              </div>
              <div class="flex items-center gap-4 font-mainHead">
                <Link href={project.url} class="text-main">
                  [ View Live ]
                </Link>{" "}
                |
                <Link
                  href={project.repo}
                  class="text-primary-900 hover:text-main"
                >
                  [ View Code ]
                </Link>
              </div>
            </div>
            <div class="col-span-5">
              <Image
                src={project.img}
                alt={project.title}
                width={300}
                height={200}
                loading="eager"
                class="w-full grayscale hover:grayscale-0 transition-all duration-500"
              />
            </div>
          </div>
          <div class="w-full  py-20 font-content">
            <p class="w-2/3 text-4xl font-bold">{project.bio}</p>
            <div class="flex justify-end py-12">
              <p class="w-1/2 uppercase text-sm">{project.description}</p>
            </div>
            <div class="space-y-20">
              {project.projectImg?.map((img) => (
                <Image
                  src={img}
                  alt={project.title}
                  width={300}
                  height={200}
                  loading="lazy"
                  class="w-full grayscale hover:grayscale-0 transition-all duration-500"
                />
              ))}
            </div>
          </div>
          <div class="flex justify-between items-center py-20 gap-8 border-t border-primary-900">
            <div class="w-1/2 flex justify-between items-end group">
              <Link
                href={`/projects/${prevSlug}`}
                class="text-primary-900 group-hover:text-main"
              >
                ← {prevProject.title}
              </Link>
              <Image
                src={prevProject.img}
                alt={prevProject.title}
                width={300}
                height={200}
                loading="lazy"
                class="w-1/2 h-36 grayscale group-hover:grayscale-0 transition-all duration-500"
              />
            </div>
            <div class="w-1/2 flex justify-between items-end group">
              <Image
                src={nextProject.img}
                alt={nextProject.title}
                width={300}
                height={200}
                loading="lazy"
                class="w-1/2 h-36 grayscale group-hover:grayscale-0 transition-all duration-500"
              />
              <Link
                href={`/projects/${nextSlug}`}
                class="text-primary-900 group-hover:text-main"
              >
                {nextProject.title} →
              </Link>
            </div>
          </div>
        </>
      ) : (
        <div class="text-center py-16">
          <h1 class="text-2xl font-bold text-red-600">Project Not Found</h1>
          <p class="text-gray-600 mt-2">
            The project you're looking for doesn't exist.
          </p>
          <Link
            href="/projects"
            class="text-blue-500 hover:underline mt-4 inline-block"
          >
            ← Back to Projects
          </Link>
        </div>
      )
    }
  </main>

  <Footer prevPage="/projects" />
</Layout>
